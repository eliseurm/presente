
<div class="p-2 sm:p-4">
    <!-- Barra Superior Responsiva -->
    <div class="mb-4">
        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3">
            <h2 class="text-xl sm:text-2xl font-bold">Gerenciamento de Pessoas</h2>
        </div>
    </div>

    <!-- Filtros Responsivos -->
    <p-card class="mb-4">
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4">

            <div class="flex flex-col gap-2">
                <label for="filtroNome" class="text-sm font-medium">Nome</label>
                <input
                    pInputText
                    id="filtroNome"
                    [(ngModel)]="filtro.nome"
                    placeholder="Filtrar por nome"
                    (keyup.enter)="filtrar()"
                    class="w-full"
                />
            </div>

            <div class="flex flex-col gap-2">
                <label for="filtroEmail" class="text-sm font-medium">E-mail</label>
                <input
                    pInputText
                    id="filtroEmail"
                    [(ngModel)]="filtro.email"
                    placeholder="Filtrar por e-mail"
                    (keyup.enter)="filtrar()"
                    class="w-full"
                />
            </div>

            <div class="flex flex-col gap-2">
                <label for="filtroTelefone" class="text-sm font-medium">Telefone</label>
                <input
                    pInputText
                    id="filtroTelefone"
                    [(ngModel)]="filtro.telefone"
                    placeholder="Filtrar por telefone"
                    (keyup.enter)="filtrar()"
                    class="w-full"
                />
            </div>

            <div class="flex flex-col gap-2">
                <label for="filtroStatus" class="text-sm font-medium">Status</label>
                <p-select
                    id="filtroStatus"
                    [(ngModel)]="filtro.status"
                    [options]="statusOptions"
                    placeholder="Selecione o status"
                    [showClear]="true"
                    optionLabel="label"
                    optionValue="value"
                    styleClass="w-full"
                ></p-select>
            </div>
        </div>

        <div class="flex flex-col sm:flex-row gap-2 mt-4 sm:justify-end">
            <p-button
                label="Filtrar"
                icon="pi pi-search"
                (onClick)="filtrar()"
                [disabled]="loading"
                styleClass="w-full sm:w-auto"
            ></p-button>
            <p-button
                label="Limpar"
                icon="pi pi-times"
                severity="secondary"
                (onClick)="limpar()"
                styleClass="w-full sm:w-auto"
            ></p-button>
        </div>

    </p-card>


    <!-- Botões acima da grid - Responsivo -->
    <div class="mb-3 flex flex-col-reverse sm:flex-row sm:justify-between sm:items-center gap-2">
        @if (selectedItems.length > 0){
            <p-button
                label="Excluir Selecionados ({{ selectedItems.length }})"
                icon="pi pi-trash"
                severity="danger"
                (onClick)="confirmarExclusaoEmLote()"
                styleClass="w-full sm:w-auto"
            ></p-button>
        }

        <p-button
            icon="pi pi-plus"
            [rounded]="true"
            severity="success"
            (onClick)="novo()"
            pTooltip="Adicionar nova pessoa"
            tooltipPosition="right"
            styleClass="w-full sm:w-auto"
        ></p-button>
    </div>

    <!-- Grid/Tabela Responsiva -->
    <div class="card overflow-x-auto">
        <p-table
            [value]="items"
            [loading]="loading"
            [paginator]="true"
            [rows]="filtro.size"
            [totalRecords]="totalRecords"
            [lazy]="true"
            (onLazyLoad)="carregar($event)"
            [(selection)]="selectedItems"
            dataKey="id"
            styleClass="p-datatable-striped p-datatable-sm"
            [tableStyle]="{'min-width': '50rem'}"
        >
            <ng-template pTemplate="header">
                <tr>
                    <th style="width: 3rem">
                        <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                    </th>
                    <th pSortableColumn="id" class="hidden sm:table-cell">
                        ID <p-sortIcon field="id"></p-sortIcon>
                    </th>
                    <th pSortableColumn="nome">
                        Nome <p-sortIcon field="nome"></p-sortIcon>
                    </th>
                    <th pSortableColumn="email" class="hidden md:table-cell">
                        E-mail <p-sortIcon field="email"></p-sortIcon>
                    </th>
                    <th pSortableColumn="telefone" class="hidden lg:table-cell">
                        Telefone <p-sortIcon field="telefone"></p-sortIcon>
                    </th>
                    <th pSortableColumn="status">
                        Status <p-sortIcon field="status"></p-sortIcon>
                    </th>
                    <th style="width: 8rem">Ações</th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-pessoa>
                <tr>
                    <td>
                        <p-tableCheckbox [value]="pessoa"></p-tableCheckbox>
                    </td>
                    <td class="hidden sm:table-cell">{{ pessoa.id }}</td>
                    <td>
                        <div class="flex flex-col">
                            <span class="font-medium">{{ pessoa.nome }}</span>
                            <!-- Mostrar email e telefone em telas pequenas -->
                            <span class="text-xs text-gray-500 md:hidden">{{ pessoa.email }}</span>
                            <span class="text-xs text-gray-500 lg:hidden md:block">{{ pessoa.telefone }}</span>
                        </div>
                    </td>
                    <td class="hidden md:table-cell">{{ pessoa.email }}</td>
                    <td class="hidden lg:table-cell">{{ pessoa.telefone }}</td>
                    <td>
                        <p-tag
                            [value]="getStatusLabel(pessoa.status)"
                            [severity]="getStatusSeverity(pessoa.status)"
                        ></p-tag>
                    </td>
                    <td>
                        <div class="flex gap-1 sm:gap-2">
                            <p-button
                                icon="pi pi-pencil"
                                [rounded]="true"
                                [text]="true"
                                severity="info"
                                (onClick)="editar(pessoa)"
                                pTooltip="Editar"
                                tooltipPosition="left"
                                size="small"
                            ></p-button>
                            <p-button
                                icon="pi pi-trash"
                                [rounded]="true"
                                [text]="true"
                                severity="danger"
                                (onClick)="confirmarExclusao(pessoa)"
                                pTooltip="Excluir"
                                tooltipPosition="left"
                                size="small"
                            ></p-button>
                        </div>
                    </td>
                </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="7" class="text-center py-4">
                        <div class="flex flex-col items-center gap-2">
                            <i class="pi pi-inbox text-4xl text-gray-400"></i>
                            <span class="text-gray-500">Nenhuma pessoa encontrada.</span>
                        </div>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>

    <!-- Dialog/Popup de Edição - Responsivo -->
    <p-dialog
        [(visible)]="displayDialog"
        [header]="getDialogHeader()"
        [modal]="true"
        [style]="{width: '95vw', maxWidth: '600px'}"
        [closable]="true"
        [draggable]="false"
    >
        <div class="flex flex-col gap-4">
            <div class="flex flex-col gap-2">
                <label for="nome" class="text-sm font-medium">
                    Nome <span class="text-red-500">*</span>
                </label>
                <input
                    pInputText
                    id="nome"
                    [(ngModel)]="currentItem.nome"
                    required
                    placeholder="Digite o nome"
                    class="w-full"
                />
            </div>

            <div class="flex flex-col gap-2">
                <label for="email" class="text-sm font-medium">
                    E-mail <span class="text-red-500">*</span>
                </label>
                <input
                    pInputText
                    id="email"
                    [(ngModel)]="currentItem.email"
                    type="email"
                    required
                    placeholder="Digite o e-mail"
                    class="w-full"
                />
            </div>

            <div class="flex flex-col gap-2">
                <label for="telefone" class="text-sm font-medium">Telefone</label>
                <input
                    pInputText
                    id="telefone"
                    [(ngModel)]="currentItem.telefone"
                    placeholder="Digite o telefone"
                    class="w-full"
                />
            </div>

            <div class="flex flex-col gap-2">
                <label for="status" class="text-sm font-medium">
                    Status <span class="text-red-500">*</span>
                </label>
                <p-select
                    id="status"
                    [(ngModel)]="currentItem.status"
                    [options]="statusOptions"
                    placeholder="Selecione o status"
                    optionLabel="label"
                    optionValue="value"
                    styleClass="w-full"
                ></p-select>
            </div>
        </div>

        <ng-template pTemplate="footer">
            <div class="flex flex-col sm:flex-row justify-end gap-2">
                <p-button
                    label="Cancelar"
                    severity="secondary"
                    (onClick)="displayDialog = false"
                    styleClass="w-full sm:w-auto"
                ></p-button>
                <p-button
                    label="Salvar"
                    icon="pi pi-check"
                    (onClick)="salvar()"
                    [disabled]="!isFormularioValido()"
                    styleClass="w-full sm:w-auto"
                ></p-button>
            </div>
        </ng-template>
    </p-dialog>

    <!-- Confirm Dialog -->
    <p-confirmDialog [style]="{width: '95vw', maxWidth: '450px'}"></p-confirmDialog>
    <p-toast position="top-right" [breakpoints]="{'920px': {width: '100%', right: '0', left: '0'}}"></p-toast>
</div>
