<div class="crud-container">
    <!-- Card de Filtros -->
    <crud-filter
        [filter]="filter"
        [fields]="filterFields"
        [loading]="loading"
        (onSearch)="filtrar()"
        (onClear)="limpar()"
    />

    <!-- Card de Resultados com ERM Data Grid -->
    <p-card class="results-card">
        <ng-template pTemplate="header">
            <div class="card-header-content">
                <h3>Lista de {{ getEntityLabelPlural() }}</h3>
            </div>
        </ng-template>

        <erm-data-grid
            [dataSource]="dataSource"
            [loading]="loading"
            (onInitNewRow)="onInitNewRow($event)"
            (onSaving)="onSavingCor($event)"
            (onDeleting)="onDeletingCor($event)">

            <erm-editing
                mode="popup"
                [allowAdding]="true"
                [allowUpdating]="true"
                [allowDeleting]="true"
                [confirmDelete]="true">

                <erm-popup
                    title="Gerenciar Cor"
                    [showTitle]="true"
                    width="700px"
                    height="auto">
                </erm-popup>

                <erm-form [colCount]="1">
                    <erm-item dataField="nome" label="Nome da Cor">
                        <erm-validation-rule type="required" message="Nome é obrigatório"></erm-validation-rule>
                    </erm-item>
                    <erm-item dataField="corHex" label="Selecione a Cor">
                        <erm-validation-rule type="required" message="Cor é obrigatória"></erm-validation-rule>
                    </erm-item>
                </erm-form>

            </erm-editing>

            <!-- Colunas da Grid -->
            <erm-column dataField="id" caption="ID" [visible]="false"></erm-column>
            <erm-column dataField="nome" caption="Nome"></erm-column>
            <erm-column dataField="corRgbA" caption="Código RGBA" [visible]="false"></erm-column>
            <erm-column dataField="corHex" caption="Código Hex" cellTemplate="colorPreview" editCellTemplate="colorEditor"></erm-column>

            <!-- Template para preview da cor na grid -->
            <ng-template ermTemplate="colorPreview" let-cor>
                <div class="color-preview" [style.background-color]="cor.corHex"></div>
            </ng-template>

            <!-- Template customizado para edição de cor no popup -->
            <ng-template ermTemplate="colorEditor" let-cor="data">
                <div class="color-picker-wrapper">
                    <p-colorPicker
                        [(ngModel)]="cor.corHex"
                        [inline]="true"
                        (onChange)="onColorChange(cor, $event)">
                    </p-colorPicker>

                    <div class="color-info">
                        <div class="color-preview-large" [style.background-color]="cor.corHex"></div>

                        <div class="color-codes">
                            <div class="field-inline">
                                <label for="corHex">HEX</label>
                                <input
                                    pInputText
                                    id="corHex"
                                    [(ngModel)]="cor.corHex"
                                    placeholder="#000000"
                                    class="color-input"
                                    (ngModelChange)="onHexChange(cor, $any($event))"
                                />
                            </div>

                            <div class="field-inline">
                                <label for="corRgba">RGBA</label>
                                <input
                                    pInputText
                                    [disabled]="true"
                                    id="corRgba"
                                    [(ngModel)]="cor.corRgbA"
                                    placeholder="rgba(0, 0, 0, 1)"
                                    class="color-input"
                                    readonly
                                />
                            </div>
                        </div>
                    </div>
                </div>
            </ng-template>

        </erm-data-grid>
    </p-card>
</div>
