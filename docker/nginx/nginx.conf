# nginx.conf (versão corrigida e unificada)

worker_processes  auto;
error_log         /var/log/nginx/error.log;
pid               /var/run/nginx.pid;

events {
    worker_connections  20000;
}

http {
    # Inclui o mime.types para que o navegador entenda os tipos de arquivo (CSS, JS, etc.)
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    # Servidor HTTP - Ouve na porta 80 e apenas redireciona para HTTPS
    server {
        listen 80;
#         server_name localhost;
#         return 301 https://$host$request_uri; # Redirecionamento permanente
#     }

#     # Servidor HTTPS - A configuração principal da sua aplicação
#     server {
#         listen 443 ssl; # Ouve na porta 443 com SSL
        server_name localhost;

        # Caminho para os certificados que mapeamos no docker-compose
#         ssl_certificate /etc/nginx/ssl/nginx-selfsigned.crt;
#         ssl_certificate_key /etc/nginx/ssl/nginx-selfsigned.key;

        root /usr/share/nginx/html;
        index index.html;

        # Configuração essencial para o roteamento do Angular (SPA)
        location / {
            try_files $uri /index.html;
        }

        # Bloco de proxy para a API, agora incluindo as configurações do seu proxy.conf
        location /api/ {
            # --- Configurações do seu nginx.conf original ---
            proxy_pass http://presentebackend:9000/;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_cache_bypass $http_upgrade;

            # --- Configurações que estavam no seu proxy.conf, agora aplicadas ---
            proxy_set_header        X-Real-IP       $remote_addr;
            client_max_body_size    10m;
            client_body_buffer_size 128k;
            proxy_connect_timeout   1200;
            proxy_send_timeout      1200;
            proxy_read_timeout      1200;
            proxy_buffers           32 4k;
        }
    }


}