#FROM openjdk:8-jre
#MAINTAINER Eliseu Rodrigues Menezes <eliseu@eliseu.eng.br>
#EXPOSE 9000
#COPY clube-2.0.0-SNAPSHOT.jar .
#ENV SPRING_DATASOURCE_URL "jdbc:mysql://clubemysqldb/clube?createDatabaseIfNotExist=true&allowPublicKeyRetrieval=true&useSSL=false"
#ENTRYPOINT ["java", "-jar", "clube-2.0.0-SNAPSHOT.jar"]



# Opcional: escolha a imagem adequada ao seu JDK (mude para 17 se possível)
FROM eclipse-temurin:17-jre-jammy

LABEL maintainer="Eliseu Rodrigues Menezes <eliseu@eliseu.eng.br>"

# Defina uma PORT padrão só para documentação; será sobrescrita pelo Render
ENV PORT=10000

# Opcional: variáveis de conexão com valores de exemplo — substitua via Render env vars
# Recomendo definir as vars (SPRING_DATASOURCE_URL, SPRING_DATASOURCE_USERNAME, SPRING_DATASOURCE_PASSWORD)
# no painel do Render, não aqui.
ENV SPRING_DATASOURCE_URL="jdbc:postgresql://localhost:5432/presente_db?currentSchema=public"
ENV SPRING_DATASOURCE_USERNAME="presente"
ENV SPRING_DATASOURCE_PASSWORD="presente"

# Copia o jar final da sua build
COPY presente-0.0.1-SNAPSHOT.jar /app/presente.jar
WORKDIR /app

# Expõe a porta (opcional)
EXPOSE ${PORT}

# JVM opts mínimos recomendados (ajuste conforme seu plano)
ENV JAVA_OPTS="-Xms256m -Xmx512m -XX:+UseG1GC -Djava.security.egd=file:/dev/./urandom"

# Use server.port=${PORT} e bind em 0.0.0.0 para ser compatível com o Render
ENTRYPOINT ["sh","-c","java $JAVA_OPTS -Dserver.port=${PORT} -Dserver.address=0.0.0.0 -jar /app/presente.jar"]
